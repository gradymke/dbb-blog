<html>
    <meta charset="UTF-8" />
    <head>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>

        <style>
            td {
                width: 50px;
                height: 50px;
            }

            .clicked {
                background-color: black;
            }

            .unclicked {
                background-color: white;
            }
        </style>
    </head>

    <body>
        <div
            x-data="{
                rows: 20,
                columns: 20,
                universe: [],
                calculateTaurusCoordinates: function(i, j) {
                    let coords = [i, j]
                    // Test the edges and wrap around (taurus)
                    if (i < 0) {
                        coords[0] = this.rows - 1;
                    } else if (i == this.rows) {
                        coords[0] = 0;
                    }
                    if (j < 0) {
                        coords[1] = this.columns - 1;
                    } else if (j == this.columns) {
                        coords[1] = 0;
                    }

                    return coords;
                },
                getNWNeighbor: function(ii, jj) {
                    let i = ii-1;
                    let j = jj-1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getNNeighbor: function(ii, jj) {
                    let i = ii-1;
                    let j = jj;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getNENeighbor: function(ii, jj) {
                    let i = ii-1;
                    let j = jj+1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getENeighbor: function(ii, jj) {
                    let i = ii;
                    let j = jj+1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getSENeighbor: function(ii, jj) {
                    let i = ii+1;
                    let j = jj+1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getSNeighbor: function(ii, jj) {
                    let i = ii+1;
                    let j = jj;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getSWNeighbor: function(ii, jj) {
                    let i = ii+1;
                    let j = jj-1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getWNeighbor: function(ii, jj) {
                    let i = ii;
                    let j = jj-1;

                    coords = this.calculateTaurusCoordinates(i, j);
                    i = coords[0];
                    j = coords[1];

                    return (this.universe[i][j] ? 1 : 0);
                },
                getNeighborCount: function(ii, jj) {
                    // Returns the number of neighbors a cell has
                    return (
                        this.getNWNeighbor(ii, jj) +
                        this.getNNeighbor(ii, jj) +
                        this.getNENeighbor(ii, jj) +
                        this.getENeighbor(ii, jj) +
                        this.getSENeighbor(ii, jj) +
                        this.getSNeighbor(ii, jj) +
                        this.getSWNeighbor(ii, jj) +
                        this.getWNeighbor(ii, jj)
                    );
                },
                shiftRight: function() {
                    let newUniverse = [];
                    for (i =  0; i < this.rows; i++) {
                        newUniverse[i] = [];
                        for (j = 0; j < this.columns; j++) {
                            if (j == this.columns - 1) {
                                newUniverse[i][0] = this.universe[i][j];
                            } else {
                                newUniverse[i][j+1] = this.universe[i][j];
                            }
                        }
                     }
                     this.universe = newUniverse;
                },
                conwayGen: function() {
                    let newUniverse = [];
                    for (let i =  0; i < this.rows; i++) {
                        newUniverse[i] = [];
                        for (let j = 0; j < this.columns; j++) {
                            nbrs = this.getNeighborCount(i, j);
                            newCell = false; // Assume death
                            console.log(i + '-' + j + ':' + nbrs);
                            // Any live cell with fewer than 2 live neighbors dies
                            // Any live cell with 2-3 neighbors stays alive
                            // Any live cell with > 3 neighbors dies
                            // Any dead cell with exactly 3 neighbors comes to life
                            if (this.universe[i][j]) {  // current cell is alive
                                if (nbrs >= 2 && nbrs <= 3) {
                                    newCell = true;
                                }
                            } else {  // Current cell is not alive
                                if (nbrs == 3) {
                                    newCell = true;
                                }
                            }
                            newUniverse[i][j] = newCell;
                        }
                    }
                    this.universe = newUniverse;
                },
                addRow: function() {
                    if (this.rows < 100) {
                         this.universe[this.rows] = [];
                         for (j = 0; j < this.columns; j++) {
                             this.universe[this.rows][j] = false;
                         }
                        this.rows++;
                    }
                },
                loseRow: function() {
                    if (this.rows > 5) {
                        for (j = 0; j < this.columns; j++) {
                            this.universe[this.rows-1][j] = false;
                        }
                        this.rows--;
                    }
                },
                addColumn: function() {
                    if (this.columns < 100) {
                        for (i = 0; i < this.rows; i++) {
                            this.universe[i][this.columns] = false;
                        }
                        this.columns++;
                    }
                },
                loseColumn: function() {
                    if (this.columns > 5) {
                        this.columns--;
                        for (i = 0; i < this.rows; i++) {
                            this.universe[i][this.columns] = false;
                        }
                    }
                }
            }"
            x-init="
                0 == 0; // no idea why there has to be an expression before the FOR loop...
                for (i =  0; i < rows; i++) {
                     universe[i] = [];
                     for  (j = 0; j < columns; j++) {
                          universe[i][j] = false;
                     }
                }
                "
        >
            <button x-on:click="console.log(universe)">Debug Universe</button>
            <button x-on:click="shiftRight">Shift Right</button>
            <button x-on:click="conwayGen">Conway</button>
            <button x-on:click="loseRow">Remove Row</button>
            <button x-on:click="addRow">Add Row</button>
            <button x-on:click="loseColumn">Remove Column</button>
            <button x-on:click="addColumn">Add Column</button>
            <table border="1">
                <tbody>
                    <template x-model="rows" x-for="ii in rows">
                        <tr>
                            <template x-model="columns" x-for="jj in columns">
                                <td
                                    x-model="universe[ii-1][jj-1]"
                                    x-on:click="universe[ii-1][jj-1] = ! universe[ii-1][jj-1]; console.log(ii + '-' + jj) "
                                    x-bind:class="universe[ii-1][jj-1] ? 'clicked' : 'unclicked'"
                                ></td>
                            </template>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </body>
</html>
